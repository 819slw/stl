<template>
    <div class="answer-container">
        <div class="setAnswerContainer">
            <p class="setTitle">Á≠îÈ¢òÂç°</p>
            <!-- È¢òÂûãÈÅçÂéÜ -->
            <div class="subjectList" v-for="(item, index) in subjectList" :key="index">
                <div class="topInfo">
                    <div class="subTitle">
                        <p class="title">{{ item.name }}</p>
                        <div class="chooseUploadType" v-if="item.uploadType || item.uploadType == 0">
                            <el-radio-group v-model="item.uploadType">
                                <el-radio
                                    v-for="(typeItem, typeIndex) in uploadTypeList"
                                    :key="typeIndex"
                                    :label="typeItem.val"
                                    >{{ typeItem.name }}</el-radio
                                >
                            </el-radio-group>
                            <el-tooltip
                                class="item"
                                effect="dark"
                                content="üì± ÊâãÊú∫Êâ´Êèè‰∫åÁª¥Á†Å ÊãçÁÖß‰∏ä‰º†Á≠îÈ¢ò"
                                placement="top"
                            >
                                <img src="@/assets/scanningQrcode.png" />
                            </el-tooltip>
                        </div>
                    </div>
                    <ul class="subInfo">
                        <!-- È¢òÂûã‰∏≠ÁöÑÊüê‰∏™È¢òÁöÑÈÅçÂéÜ -->
                        <li :key="i" v-for="(el, i) in item.list" class="subGrid">
                            <div class="answerItem">
                                <p class="sortIndex">{{ i + 1 }}.</p>

                                <!-- ÂçïÈÄâ / Â§öÈÄâÁöÑÈÄâÈ°πÈÅçÂéÜ -->
                                <div class="subTypeGrid" v-if="Number(item.type) === 1 || Number(item.type) === 2">
                                    <el-button
                                        @click="setOptionActive(item.type, index, i, optionIndex)"
                                        class="optionBtn"
                                        :key="optionIndex"
                                        v-for="(optionRes, optionIndex) in el.optionList"
                                        :type="optionRes.isActive ? 'warning' : ''"
                                        size="small"
                                        round
                                    >
                                        {{ optionRes.name }}
                                    </el-button>
                                </div>

                                <!-- Âà§Êñ≠È¢òÈÄâÈ°πÈÅçÂéÜ -->
                                <div class="subTypeGrid" v-else-if="Number(item.type) === 3">
                                    <el-button
                                        @click="setJudgeActive(index, i, optionIndex)"
                                        class="optionBtn"
                                        :key="optionIndex"
                                        v-for="(optionRes, optionIndex) in el.optionList"
                                        :type="optionRes.isActive ? 'warning' : ''"
                                        size="small"
                                        round
                                    >
                                        {{ optionRes.name }}
                                    </el-button>
                                </div>
                                <!-- ‰∏ªËßÇÈ¢òUI -->
                                <div class="subTypeGrid" v-else>
                                    <div class="imgList">
                                        <upload-img
                                            :imageUrl="item.answerUrl"
                                            :single="false"
                                            refDom="clearErrorone"
                                            word="communityLogo"
                                            @addSignPic="updateIcon"
                                            :disabled="isUpimg"
                                        ></upload-img>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="select-type">
            <el-form label-width="120px">
                <el-form-item label="Á≠îÊ°à‰∏ãÂèëÊñπÂºè">
                    <el-select v-model="answerDistributionMethod" placeholder="ËØ∑ÈÄâÊã©">
                        <el-option
                            v-for="(item, index) in answerMethod"
                            :key="index"
                            :label="item"
                            :value="index + 1"
                        >
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-form>
        </div>
        <div class="bottomGrid">
            <el-row>
                <el-button class="plain-btn" @click="beforePage">‰∏ä‰∏ÄÊ≠•</el-button>
                <el-button type="warning" @click="onSubmit">‰øùÂ≠òÂπ∂‰∏ã‰∏ÄÊ≠•</el-button>
                <el-button class="plain-btn">‰øùÂ≠ò</el-button>
            </el-row>
        </div>
    </div>
</template>

<script>
import uploadImg from '@/components/uploadImg';

export default {
    components: {
        uploadImg,
    },
    data() {
        return {
            activeColor: '#ED6D00',
            subjectList: [],
            answerDistributionMethod: 1,
            answerMethod: ['Ëá™Ë°åÊìç‰Ωú‰∏ãÂèë', 'Êà™Ê≠¢Êó∂Èó¥‰∏ãÂèë', 'Âõ∫ÂÆöÊó∂Èó¥‰∏ãÂèë'],
            uploadTypeList: [
                {
                    name: 'ÂàÜÈ¢ò‰∏ä‰º†',
                    val: 0,
                },
                {
                    name: 'Êï¥‰Ωì‰∏ä‰º†',
                    val: 1,
                },
            ],
            judgeSubList: [
                {
                    name: 'Ê≠£Á°Æ',
                    val: 1,
                    isActive: false,
                },
                {
                    name: 'ÈîôËØØ',
                    val: 0,
                    isActive: false,
                },
            ],
            resultArr: [
                {
                    type: 1,
                    name: 'ÂçïÈÄâÈ¢ò',
                    value: 'A,B,C,D,E',
                    sort: 1,
                },
                {
                    type: 1,
                    name: 'ÂçïÈÄâÈ¢ò',
                    value: 'A,B,C,D,E',
                    sort: 2,
                },
                {
                    type: 1,
                    name: 'ÂçïÈÄâÈ¢ò',
                    value: 'A,B,C,D,E',
                    sort: 3,
                },
                {
                    type: 1,
                    name: 'ÂçïÈÄâÈ¢ò',
                    value: 'A,B,C,D,E',
                    sort: 4,
                },
                {
                    type: 2,
                    name: 'Â§öÈÄâ',
                    value: 'A,B,C,D,E',
                    sort: 5,
                },
                {
                    type: 2,
                    name: 'Â§öÈÄâ',
                    value: 'A,B,C,D,E',
                    sort: 6,
                },
                {
                    type: 2,
                    name: 'Â§öÈÄâ',
                    value: 'A,B,C,D,E',
                    sort: 7,
                },
                {
                    type: 3,
                    name: 'Âà§Êñ≠',
                    sort: 8,
                },
                {
                    type: 3,
                    name: 'Âà§Êñ≠',
                    sort: 9,
                },
                {
                    type: 3,
                    name: 'Âà§Êñ≠',
                    sort: 10,
                },
                {
                    type: 4,
                    name: 'Â°´Á©∫',
                    sort: 11,
                },
                {
                    type: 4,
                    name: 'Â°´Á©∫',
                    sort: 12,
                },
                {
                    type: 4,
                    name: 'Â°´Á©∫',
                    sort: 13,
                },
            ],
        };
    },
    created() {
        this.resultArr.forEach((res) => {
            // ÂÖàÁúãÂ≠ò‰∏çÂ≠òÂú®ËøôÁ±ªÈ¢òÂûã
            let isLive = this.subjectList.findIndex((v) => v.type === res.type);

            if (Number(res.type) === 1) {
                // res = this.setOption(res)
            }

            if (isLive > -1) {
                // Â≠òÂú®Â∞±Áõ¥Êé•push
                this.subjectList[isLive].list.push(res);
            } else {
                // ‰∏çÂ≠òÂú®Â∞±ÂÖàÂàõÂª∫
                this.subjectList.push({
                    type: res.type,
                    name: res.name,
                    list: [res],
                });
                isLive = this.subjectList.length - 1;
            }

            // ÁªÑË£Ö + Ê∑ªÂä†ËÆøÈóÆÂô®Â±ûÊÄß
            if (Number(res.type) === 1 || Number(res.type) === 2) {
                this.setChooseSubAccessorAttribute(isLive, res);
            } else if (Number(res.type) === 3) {
                this.setJudgeSubAccessorAttribute(isLive, res);
            } else {
                // ÂÖ∂‰ΩôÁ±ªÂûãÈÉΩÂøÖÈ°ªÈÖçÁΩÆ‰∏Ä‰∏™ÂºÄÂÖ≥ ‰ª£Ë°®ÊòØÂê¶ÊòØÊï¥‰Ωì‰∏ä‰º†ËøòÊòØÂàÜ‰Ωì‰∏ä‰º†ÔºåÈªòËÆ§ÊòØÂàÜ‰Ωì‰∏ä‰º†
                this.setSubjectiveAccessorAttribute(isLive, res);
            }
        });
    },
    methods: {
        // ËÆæÁΩÆ‰∏ªËßÇÈ¢òÁõÆÁöÑËÆøÈóÆÂô®Â±ûÊÄß
        setSubjectiveAccessorAttribute(totalIndex) {
            // Ê∑ªÂä†ÊòØÂê¶Â±ïÁ§∫ÂçïÈÄâÊ°ÜÁªÑÔºàÈÄâÊã©ÊòØÂàÜÈ¢òËøòÊòØÊï¥‰Ωì‰∏ä‰º†ÔºâÁöÑÂ±ûÊÄß
            this.$set(this.subjectList[totalIndex], 'uploadType', 0);
            // Ê∑ªÂä†‰∏ä‰º†ÂõæÁâáÁöÑÂ±ûÊÄßÔºàÂõæÁâáÊúÄÂ§ö‰∏âÂº†ÔºåÊöÇÂÆöÁî®StringÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑÂ±ïÁ§∫Ôºâ
            this.$set(this.subjectList[totalIndex].list[this.subjectList[totalIndex].list.length - 1], 'answerUrl', '');
        },
        // ËÆæÁΩÆÂà§Êñ≠È¢òÁõÆÁöÑËÆøÈóÆÂô®Â±ûÊÄß
        setJudgeSubAccessorAttribute(totalIndex) {
            this.$set(
                this.subjectList[totalIndex].list[this.subjectList[totalIndex].list.length - 1],
                'optionList',
                []
            );
            this.judgeSubList.forEach((el, index) => {
                this.$set(
                    this.subjectList[totalIndex].list[this.subjectList[totalIndex].list.length - 1].optionList,
                    index,
                    { ...el }
                );
            });
        },
        // ËÆæÁΩÆÈÄâÊã©È¢òÁõÆÁöÑËÆøÈóÆÂô®Â±ûÊÄß
        setChooseSubAccessorAttribute(totalIndex, res) {
            let arr = res.value.split(',');
            this.$set(
                this.subjectList[totalIndex].list[this.subjectList[totalIndex].list.length - 1],
                'optionList',
                []
            );
            (arr || []).forEach((el, index) => {
                this.$set(
                    this.subjectList[totalIndex].list[this.subjectList[totalIndex].list.length - 1].optionList,
                    index,
                    {
                        name: el,
                        isActive: false,
                    }
                );
            });
        },
        setJudgeActive(index, i, optionIndex) {
            this.subjectList[index].list[i].optionList.map((v) => {
                v.isActive = false;
            });
            this.subjectList[index].list[i].optionList[optionIndex].isActive = true;
        },
        setOptionActive(type, index, i, optionIndex) {
            if (Number(type) === 1) {
                this.subjectList[index].list[i].optionList.map((v) => {
                    v.isActive = false;
                });
            } else {
                let isChoosed = this.subjectList[index].list[i].optionList.findIndex((v) => v.isActive);
                if (isChoosed === optionIndex) {
                    this.subjectList[index].list[i].optionList[optionIndex].isActive = false;
                    return;
                }
            }
            this.subjectList[index].list[i].optionList[optionIndex].isActive = true;
        },
    },
};
</script>

<style lang="scss">
.answer-container {
    height: 100%;
    display: flex;
    flex-direction: column;
    .bottomGrid {
        .el-button.plain-btn,
        .el-button.plain-btn:focus,
        .el-button.plain-btn:hover {
            color: #ed6d00;
            border: 1px solid #ed6d00;
        }
    }
    .select-type {
        height: 56px;
        padding-top: 16px;
    }
}

.setAnswerContainer {
    flex: 1;
    background: #fff;
    padding: 16px;
    flex: 1;
    overflow: auto;
    border: 1px solid #d8d8d8;
    box-sizing: border-box;
    .setTitle {
        font-size: 18px;
        font-weight: 600;
        color: rgba(9, 34, 56, 1);
    }
    .subInfo {
        background: #fff;
        padding-top: 16px;
        .subGrid {
            list-style: none;
            padding-bottom: 16px;
            .sortIndex {
                font-size: 14px;
                font-weight: 500;
                color: rgba(9, 34, 56, 1);
            }
            .answerItem {
                display: flex;
                padding-left: 20px;
                align-items: center;
                .subTypeGrid {
                    display: flex;
                    align-items: center;
                }
                .optionBtn {
                    margin-left: 20px;
                    width: 48px;
                    height: 24px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    line-height: 0;
                }
            }
        }
    }
    .subTitle {
        font-size: 16px;
        font-weight: 500;
        color: rgba(9, 34, 56, 1);
        margin: 10px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        .title {
            font-weight: 600;
        }
        .chooseUploadType {
            display: flex;
            align-items: center;
            img {
                width: 16px;
                height: 16px;
                padding: 4px;
                margin-left: 5px;
                cursor: pointer;
            }
        }
    }
}
</style>
